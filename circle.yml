machine:
  node:
    version: 0.12.2

  python:
    version: 2.7.9

general:
  branches:
    ignore: # list of branches to ignore
      - gh-pages 
      - /feature\/.*/

dependencies:
  pre:
    - 'pip install awscli==1.7.8'
    - 'sudo apt-get update; sudo apt-get install zip'
    - 'npm install'

deployment:
  production:
    branch: master
    commands:
      - 'echo {} > config/stage.json'
      - 'zip -r lambda.zip . -x *.git* -x *.vagrant*'
      - 'aws lambda upload-function --function-name=img-optimize-prod --function-zip=lambda.zip --runtime=nodejs --role="arn:aws:iam::273752619615:role/lambda_exec_role" --handler=index.handler --mode=event --region=us-west-2'

  stage:
    branch: develop
    commands:
      - 'echo {} > config/prod.json'
      - 'zip -r lambda.zip . -x *.git* -x *.vagrant*'
      - 'aws lambda upload-function --function-name=img-optimize-stage --function-zip=lambda.zip --runtime=nodejs --role="arn:aws:iam::273752619615:role/lambda_exec_role" --handler=index.handler --mode=event --region=us-west-2'
